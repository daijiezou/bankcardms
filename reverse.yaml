# 生成工具从这里下载：
# https://gitea.com/xorm/reverse

kind: reverse
name: bank-card-ms
source:
  database: mysql
  # 使用之前，请配置 qa-4，增加该 MySQL 的 NodePort
  conn_str: root:dai3023273@tcp(101.35.6.121:3306)/bank-card-ms?charset=utf8
targets:
  - type: codes
    table_mapper: snake # how table name map to class or struct name
    column_mapper: snake # how column name map to class or struct field name
    table_prefix: "" # table prefix
    multiple_files: true # generate multiple files or one
    language: golang
    template: | # 相比官方的，加了个 json 的 tag。还需要什么，可以自己加
      package do

      {{$ilen := len .Imports}}
      {{if gt $ilen 0}}
      import (
        {{range .Imports}}"{{.}}"{{end}}
      )
      {{end}}

      {{range .Tables}}
      type {{TableMapper .Name}} struct {
      {{$table := .}}
      {{range .ColumnsSeq}}{{$col := $table.GetColumn .}}	{{ColumnMapper $col.Name}}	{{Type $col}} `json:"{{$col.Name}}" {{ Tag $table $col}}`
      {{end}}
      }

      func (m *{{TableMapper .Name}}) TableName() string {
        return "{{$table.Name}}"
      }
      {{end}}
    output_dir: ./internal/data/do/tmp # code output directory
